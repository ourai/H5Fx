/*!
 * H5Fx v1.0.0
 * https://github.com/ourai/H5Fx
 *
 * Copyright 2015, 2015 Ourairyu, http://ourai.ws/
 *
 * Date: 2015-08-01
 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("Requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;g={name:"H5F",version:"1.0.0"},h="{{s*([A-Z_]+)s*}}",i={ABSOLUTE_URL:{rule:/^.*$/,message:"NOT_AN_ABSOLUTE_URL"},EMAIL:{rule:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,message:"NOT_AN_EMAIL"},NUMBER:{rule:/^(\-)?\d+(\.\d+)?$/,message:"NOT_A_NUMBER"}},c={UNKNOWN_INPUT_TYPE:"Unknown input type for {{LABEL}}.",COULD_NOT_BE_EMPTY:"{{LABEL}} could not be empty.",LENGTH_SMALLER_THAN_MINIMUM:"The length of {{LABEL}} is smaller than {{MINLENGTH}}.",LENGTH_BIGGER_THAN_MAXIMUM:"The length of {{LABEL}} is bigger than {{MAXLENGTH}}.",INVALID_VALUE:"{{LABEL}}'s value is invalid.",NOT_AN_ABSOLUTE_URL:"{{LABEL}} isn't an absolute URL.",NOT_AN_EMAIL:"{{LABEL}} isn't an E-mail.",NOT_A_NUMBER:"{{LABEL}} isn't a number.",UNDERFLOW:"{{LABEL}}'s value is smaller than {{MIN}}.",OVERFLOW:"{{LABEL}}'s value is bigger than {{MAX}}.",DIFFERENT_VALUE:"{{LABEL}}'s value is different from {{ASSOCIATE_LABEL}}.",AT_LEAST_CHOOSE_ONE:"At least choose an option from {{LABEL}}.",SHOOLD_BE_CHOSEN:"{{UNIT_LABEL}} shoold be chosen.",SHOOLD_CHOOSE_AN_OPTION:"Must choose an option of {{LABEL}}."},d={SUBMIT:"H5F:submit",DESTROY:"H5F:destroy",BEFORE_VALIDATE:"H5F:beforeValidate",UPDATED:"H5F:updated",VALIDATE:"H5F:validate",VALID:"H5F:valid",INVALID:"H5F:invalid",DISABLED:"H5F:disabled",ENABLED:"H5F:enabled"},s=function(a,b){return a.hasAttribute(b)},D=function(a){return parseFloat(a)},o=function(a){var b,c,d;return a=$(a),c=a.closest("form").eq(0),this.form=c.get(0),this.type=m(a),this.name=a.prop("name"),this.__form=null,this.__counted=!1,this.__enabled=!0,this.__checkable=-1!==$.inArray(a.prop("type"),["radio","checkbox"]),this.__validations=[],this.__checkable?(b=$("[name='"+this.name+"']",c),d=b.closest(x(this.type)),this.__defaultValue=b.closest(":checked"),this.element=$.makeArray(b),this.required=d.size()>0,this.label=n(this.required?d.eq(0):$(this.element[0]),c),this.validate=G):(this.element=a.get(0),this.required=s(this.element,"required"),this.label=n(a,c),"select"===this.element.tagName.toLowerCase()?(this.__defaultValue=$(":selected",a),this.validate=K):(this.__defaultValue=a.val(),this.validate=L,this.pattern=a.attr("pattern")),this.required&&u(a,c).addClass("H5F-label--required")),y.call(this)},m=function(a){var b;return"input"===a.get(0).tagName.toLowerCase()?null!=(b=a.attr("type"))?b:"text":a.prop("type")},q=function(a,b){var c;return $.isNumeric(c=$(a).prop(b))?D(c):null},u=function(a,b){var c;return null!=(c=a.attr("id"))?$("label[for='"+c+"']",b):a.closest("label")},n=function(a,b,c){var d,e;return c!==!1&&(e=a.attr("data-label")),null==e&&(d=u(a,b),e=d.size()>0?$.trim(d.text()):""),e},j=function(a){return $("#"+$(a).attr("data-associate"))},y=function(){this.valid=!0,this.message=""},z=function(){var a;a=$(this.element),this.__checkable?(a.closest(":checked").prop("checked",!1),$(this.__defaultValue).prop("checked",!0)):"select"===this.element.tagName.toLowerCase()?($(":selected",a).prop("selected",!1),$(this.__defaultValue).prop("selected",!0)):a.val(this.__defaultValue)},A=function(){this.__counted=!1,this.validated=!1,y.call(this),z.call(this)},E=function(a,b){return $(b).trigger(a.valid?d.VALID:d.INVALID,a)},x=function(a){return"string"===$.type(a)&&(a="checkbox"===a),"["+(a?"data-":"")+"required]"},L=function(){var a,b,c,d,e,f,g,k,l,m;if(c=this.element,k=this.value(),this.required&&""===$.trim(k))this.valid=!1,this.message=this.error("COULD_NOT_BE_EMPTY");else{switch(this.type){case"text":case"search":case"tel":case"url":case"email":case"password":case"textarea":s(c,"minlength")&&k.length<1*$(c).attr("minlength")?(this.valid=!1,this.message=this.error("LENGTH_SMALLER_THAN_MINIMUM")):s(c,"maxlength")&&k.length>1*$(c).attr("maxlength")?(this.valid=!1,this.message=this.error("LENGTH_BIGGER_THAN_MAXIMUM")):(""!==k&&("url"===this.type?(this.valid=i.ABSOLUTE_URL.rule.test(k),this.valid||(this.message=this.error(i.ABSOLUTE_URL.message))):"email"===this.type&&(this.valid=i.EMAIL.rule.test(k),this.valid||(this.message=this.error(i.EMAIL.message)))),this.valid&&null!=this.pattern&&""!==this.pattern&&(b=i[null!=(l=null!=(m=this.pattern.match(new RegExp("^s*"+h+"s*$")))?m[1]:void 0)?l:""],null!=b?(g=b.rule,null!=b.message&&(e=this.error(b.message))):g=new RegExp("^"+this.pattern+"$"),this.valid=g.test(k),this.valid||(this.message=null!=e?e:this.error("INVALID_VALUE"))));break;case"number":""!==k&&(this.valid=i.NUMBER.rule.test(k),this.valid?(f=q(c,"min"),d=q(c,"max"),null!=f&&D(k)<f?(this.valid=!1,this.message=this.error("UNDERFLOW")):null!=d&&D(k)>d&&(this.valid=!1,this.message=this.error("OVERFLOW"))):this.message=this.error(i.NUMBER.message));break;default:this.message=this.error("UNKNOWN_INPUT_TYPE")}this.valid&&s(c,"data-associate")&&(a=j(c),a.size()&&(this.valid=k===a.val(),this.valid||(this.message=this.error("DIFFERENT_VALUE")))),this.valid&&this.__validations.length>0&&$.each(this.__validations,function(a){return function(b,d){var e;return a.valid=$.isFunction(d.handler)?d.handler.call(c)===!0:!1,a.valid||(a.message=/^[A-Z_]+$/.test(d.message)?a.error(d.message):null!=(e="function"==typeof d.message?d.message():void 0)?e:d.message),a.valid}}(this))}return E(this,c),this.valid},K=function(){return this.required&&""===$.trim(this.value())&&(this.valid=!1,this.message=this.error("SHOOLD_CHOOSE_AN_OPTION")),E(this,this.element),this.valid},G=function(){var a,b,c;return b=$(this.element),c="checkbox"===this.type,this.required&&0===b.closest(":checked").size()?(this.valid=!1,this.message=this.error("AT_LEAST_CHOOSE_ONE"),a=b.closest(x(c))):c?(a=b.closest("[required]"),a.size()>0?(a.each(function(a){return function(b,c){return a.valid=$(c).is(":checked"),a.valid||(a.__element=c),a.valid}}(this)),this.valid?delete this.__element:this.message=this.error("SHOOLD_BE_CHOSEN")):a=b):a=b,E(this,a.get(0)),this.valid},e=function(){function a(){return b.apply(this,arguments)}var b;return b=o,a.prototype.value=function(){return this.__checkable?$("[name='"+this.name+"']:checked",$(this.form)).val():$(this.element).val()},a.prototype.reset=y,a.prototype.error=function(a){var b,d;return d=this,b=$(d.element),c[a].replace(new RegExp(h,"g"),function(a,c){var e;switch(c){case"LABEL":e=d.label;break;case"VALUE":e=d.value();break;case"ASSOCIATE_LABEL":e=n(j(b),$(d.form));break;case"UNIT_LABEL":e=n($(d.__element),$(d.form),!1);break;case"LENGTH":e=d.value().length;break;case"MINLENGTH":e=b.attr("minlength");break;case"MAXLENGTH":e=b.attr("maxlength");break;case"MIN":e=q(b,"min");break;case"MAX":e=q(b,"max")}return e})},a.prototype.addValidation=function(a){return this.__validations.push(a),a},a.prototype.disableValidation=function(a){return this.__enabled=!1,a===!0&&(this.__disabled=!0),this.__counted===!0&&this.__form.invalidCount--,A.call(this),$(this.element).trigger(d.DISABLED),this},a.prototype.enableValidation=function(a){var b;return this.__enabled=!0,b=this.element,delete this.__disabled,$(b).trigger(d.ENABLED),a===!0&&$(this.__checkable?b[0]:b).trigger(d.VALIDATE),this},a.prototype.isEnabled=function(){return this.__enabled===!0},a.prototype.isValid=function(){return this.valid===!0},a.prototype.isDisabled=function(){return this.__checkable?!1:$(this.element).prop("disabled")},a}(),B=":submit, :image, :reset",I="[name]:not([type='hidden'], "+B+")",l={immediate:!1},t=0,v=function(a){var b;return b=navigator.userAgent.toLowerCase().match(/msie (\d+\.\d+)/),null!=b?1*b[1]<a:!1},H=function(a,b){return b.reset(),b.validated=!0,b.validate()?(b.__counted===!0&&a.invalidCount--,b.__counted=!1):(b.__counted!==!0&&a.invalidCount++,b.__counted=!0),b},J=function(a,b){return null!=a.sequence?$.each(a.sequence,function(c,e){var f,g,h;return h=a.fields[e],g=h.element,f=h.__checkable,f||(h.__disabled===!0?h.isDisabled()===!1&&h.enableValidation():h.isDisabled()===!0&&h.disableValidation(!0)),(!f&&s(g,"data-associate")||!b)&&(h.validated=!1),h.isEnabled()&&h.validated===!1&&$(f?g[0]:g).trigger(d.VALIDATE),!0}):void 0},k=function(a,b,c){return a.on(d.VALIDATE,"[name]",function(){var a;return a=b.fields[$(this).prop("name")],a.isEnabled()&&H(b,a),a}),c===!0&&(a.on("change.H5F","[name]:checkbox, [name]:radio, select[name]",function(){return $(this).trigger(d.VALIDATE)}),a.on(v(9)?"change.H5F":"input.H5F","[name]:not(:checkbox, :radio, "+B+", select, option)",function(){return $(this).trigger(d.VALIDATE)})),a.on("submit.H5F",function(a){return $(this).trigger(d.BEFORE_VALIDATE,b),J(b,c),b.invalidCount>0?(a.preventDefault(),a.stopImmediatePropagation()):$(this).trigger(d.SUBMIT,[b,a])})},C=function(a){return a.toString(16)},p=function(){return"H5F0RM"+C(t)+C((new Date).getTime())+C(f.forms.length+1)},r=function(a){var b,c;return"object"===$.type(a)?b=(1===a.nodeType?a:null!=(c="function"==typeof a.get?a.get(0):void 0)?c:{})["H5F-form"]:"string"===$.type(a)&&(b=a),b},w=function(){var a,b;return b=[],a={},$(""+I,$(this.form)).each(function(c){return function(d,f){var g;g=$(f).attr("name"),null==a[g]&&(a[g]=c.addField(new e(f)),b.push(g))}}(this)),b},F=function(){var a;return a=w.call(this),0===a.length?(delete this.fields,delete this.sequence):($.each(this.sequence,function(b){return function(c,d){-1===$.inArray(d,a)&&delete b.fields[d]}}(this)),this.sequence=a),this.fields},f=function(){function a(a){this.form=a,this.novalidate=s(a,"novalidate"),this.invalidCount=0,t++,$(""+I,$(a)).each(function(a){return function(b,c){return a.addField(new e(c))}}(this))}return a.prototype.addField=function(a){var b;return null==this.fields&&(this.fields={}),null==this.sequence&&(this.sequence=[]),b=a.name,null==this.fields[b]&&(a.__form=this,a.validated=!1,this.fields[b]=a,this.sequence.push(b)),a},a.prototype.addValidation=function(a,b){var c;return null!=(c=this.fields[a])?c.addValidation(b):void 0},a.prototype.disableValidation=function(a){var b;return null!=(b=this.fields[a])?b.disableValidation():void 0},a.prototype.enableValidation=function(a,b){var c;return null!=(c=this.fields[a])?c.enableValidation(b):void 0},a.prototype.update=function(){return F.call(this),$(this.form).trigger(d.UPDATED),this},a.prototype.destroy=function(){var a;return a=$(this.form),a.off(".H5F"),$("[name]",a).off(".H5F"),$(".H5F-label--required",a).removeClass("H5F-label--required"),this.novalidate?a.attr("novalidate",!0):a.removeAttr("novalidate"),delete this.constructor.forms[this.form["H5F-form"]],delete this.form["H5F-form"],this.constructor.forms.length--,a.trigger(d.DESTROY),a.get(0)},a.RULES=$.extend(!0,{},i),a.version=g.version,a.forms={length:0},a.init=function(a,b){var c;return c=this,$(a).each(function(){var a,d,e,f,g;return d=$(this),a="H5F-form",g=$.extend({},l,b,{immediate:function(){var a;return a=d.attr("data-immediate"),a="true"===a?!0:"false"===a?!1:void 0}()}),null==this[a]&&(f=new c(this),e=p(f),c.forms[e]=f,c.forms.length++,this[a]=e,d.attr("novalidate",!0),null==d.attr("data-novalidate"))?k(d,f,g.immediate===!0):void 0})},a.get=function(a){return this.forms[r(a)]},a.errors=function(a){return $.extend(c,a)},a.rules=function(a){return this.RULES=$.extend(!0,{},$.extend(i,a))},a}(),a[g.name]=f});